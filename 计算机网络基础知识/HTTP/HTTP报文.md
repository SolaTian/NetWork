# 3、`HTTP`报文

`HTTP`报文分成报文首部和报文主体，由`0x0d`和`0x0a`换行来划分，并不一定要有报文主体。

请求报文和响应报文首部的组成：
1. 请求行：包含请求的`URI`和`HTTP`版本
2. 状态行：包含响应结果的状态码，原因短语和`HTTP`版本
3. 首部字段：包含请求和响应的各种属性和条件的首部
4. 其他：如`Cookie`。

## 3.1、编码提升传输速率

> 内容编码：指明应用在实体内容上的编码格式，并保持实体信息原样压缩，内容编码之后的实体由客户端接收并负责解码。

常用的内容编码：
- `gzip` (GNU zip)
- `compress` (UNIX系统的标准压缩)
- `deflate` (zlib)
- `identity` (不进行编码)

`HTTP`通信过程中，请求的编码实体尚未传输完成之前，浏览器无法显示请求页面，通过对实体主体分块，最后一块用换行来标记。让浏览器逐步显示页面，实体主体分块的功能称为`分块传输编码`。

## 3.2、发送多种数据的多对象集合(`MIME`)

`HTTP`报文中使用多部分对象集合时，需要在首部字段里加上`Content-type`字段，使用`boundary`字符串来划分多部分对象集合指明的各类实体。每个部分类型中均可以含有首部字段，也可以在某个部分中嵌套使用多对象集合。

## 3.3、获取部分内容的范围请求

针对下载过程遇到中断需要从头开始的情况，需要`可恢复机制`。下载时指定下载的实体范围，指定范围发送的请求叫做`范围请求`，用首部字段`Range`来指定资源的`byte`范围。

对于范围请求，响应会返回状态码`206 Partial Content`，如果无法响应范围请求，则返回状态码`200 OK`。

## 3.4、内容协商返回最合适的内容

> 内容协商机制：客户端和服务器端就响应的资源内容进行交涉，然后提供给客户端最为合适的资源，内容协商会以语言，字符集，编码方式等为基准判断响应的资源。

同一个`web`可能，包括中文页面和英文页面。浏览器会根据自己的默认语言，显示对应语言版的`web`页面，这种机制叫做内容协商。

内容协商有3种类型：
1. 服务器驱动协商：由服务器进行内容协商；
2. 客户端驱动协商：由客户端进行内容协商。用户从浏览器显示的可选列表中手动选择。如自行切换`PC`版页面或手机版页面；
3. 透明协商：服务器驱动和客户端驱动的结合体，由服务端和客户端各自进行协商的一种方法。


