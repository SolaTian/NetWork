# 防火墙

防火墙这个装置原本用于防范外部网络，也就是拥有多个不特定用户的公共网络对内部网络进行的`DoS`攻击或者不法访问。现在也开始需要防范从内部网络向互联网泄露信息或者将内部网络作为攻击跳板等行为。


## 防火墙的分类

|防火墙的分类|说明|
|-|-|
|软件型防火墙-个人防火墙|运行于个人计算机上，用于监控个人计算机与外部网络之间的通信信息。包括以下功能：<li>确认连接请求；<li>安全日志；<li>反病毒功能，阻止接收到的计算机病毒和蠕虫通信；<li>反间谍软件功能，阻止接收到来自于以犯罪为目的的间谍软件或程序的通信；<li>个人信息保护功能，设立对策以防止个人信息被窃取、浏览恶意网站以及钓鱼诈骗等|
|软件型防火墙-网关型防火墙|在计算机网络的网关中设置类似于防火墙设备的功能，对网络中的通信流量进行控制<li>在`Windows`，`Linux`等通用操作系统上安装并运行软件的软件型网关防火墙；<li>使用专用设备的硬件型网关防火墙；<li>个人防火墙主要监控所有到达个人计算机的通信流量，网关型防火墙需要监控来自于多数不特定终端设备的通信流量，并在它们通过网关时实施策略控制；<li>代理服务器是应用层网关型防火墙的一种|
|硬件防火墙|通过硬件设备实现的防火墙，外形同路由器形状类似，但是网络接口类型一般只支持以太网。|


## 防火墙中搭载的各种功能

|功能|说明|
|-|-|
|会话管理|<li>`TCP`连接管理，包括`SYN`检查（过滤非`SYN`消息），`ACK`检查，同一数据段检查（指定使用重新接收到的重复数据段或者丢弃），窗口检查（检查`TCP`首部内的序号和滑动窗口的大小，拦截超过滑动窗口容量数据的序列号），数据段重组（在防火墙内调整`TCP`数据段的序列号）<li>会话建立的处理<li>会话的生存时间<li>会话终止处理<li>`UDP`数据流的管理<li>管理`ICMP`和`IP`数据流<li>会话同步|
|分组结构解析|防止非法的分组的流入和流出，包括对`IP`首部解析，`TCP`首部解析，`UDP`首部解析|
|安全区域|将防火墙上物理接口以及逻辑接口分配至不同的区域中，即将与防火墙连接的网段划分到不同的区域中，其中一个网络接口不能属于多个区域。同一个区域内可以自由进行基本通信，但是跨区域的通信必须符合安全策略才可以完成。<li>公司内部网络等，需要由组织来保护的网络一般称为信任区域<li>与信任区域相对的是外部网络，如互联网等，一般称为不信任区域。|
|安全策略|防火墙的主要功能是访问控制，访问控制通过指定规则，包括需要控制的发送源，目的地以及通信等内容信息。在路由器中称为访问控制列表，在防火墙中称为安全策略|
|`NAT`|可以通过路由器或者防火墙将发送源的私有`IP地址`转换为全局`IP地址`，这一转换过程叫做`NAT`。路由器以及防火墙等运行`NAT`功能的装置统称为网关<li>静态`NAT`：指将`NAT`之前的地址和`NAT`之后的地址进行1对1的分配，由管理员将信息设置到网关中。<li>动态`NAT`：首先给网关指定一个名为`IP地址池`的`IP地址`范围，在`NAT`所需会话建立时，地址池里面的`IP地址`将会顺序分配称为一个转换后的`IP地址`。<li>发送源`NAT`：位于公司内部网络，使用私有`IP`的客户端在作为发送源将数据发送至网关时，必须将私有`IP地址`转换为全局地址才能进行访问外部互联网上的服务器。<li>目的地`NAT`：网关作为内部服务器的代理，定义全局地址，并将来自外部网络的客户端访问转移到该全局地址上。网关接收到目的地为全局地址的分组后，将该分组的目的地址再转换为内部服务器所拥有的实际私有地址，从而完成路由。|
|`VPN`|虚拟私有网络。私有网络指使用私有`IP地址`、位于组织内部的网络，`Intranet`，而`VPN`是使用公共互联网或者电信运行商提供的公共网络技术，构建廉价`Intranet`的技术。|
|`DoS`防御|`DoS`是无法继续提供服务的意思，`DoS`攻击是针对服务器以及网络硬件发起攻击，使服务器以及网络硬件无法完成正常的应答响应。<li>`DoS`防御即限制被判定为`DoS`攻击的异常高速率通信流量的功能，一般通过设置区域、网络接口、网络等单位来实现；<li>攻击在发起攻击时，会对攻击对象进行扫描，基础的方式就是端口扫描，大致分为`TCP端口扫描`和`UDP端口扫描`，对`TCP端口`以及`UDP端口`顺序发送分组进行通信，从而探测目标机器是否开启了对应的服务。防火墙也可以对端口扫描行为进行探测并阻断。|
|防范基于分组的攻击|防范使用非法分组这类基于分组的`DoS`攻击和非法入侵|
|基于内容的扫描||
|监视、报告功能||
|分组捕获|发生通信故障时，可以根据所捕获的分组信息进行进一步的分析|
|虚拟路由器|几乎所有的防火墙均实现了静态路由和动态路由的功能。使用多个虚拟路由器时，即使遭到某个攻击导致数据被篡改或窃听，也不会对其他虚拟路由器造成影响，可以提高网络的安全性|
|虚拟防火墙|在一台物理设备上虚拟出多个逻辑防火墙的功能，主要用于网络服务供应商同时为多个企业提供企业防火墙的业务中|






|`VPN`分类|说明|
|-|-|
|站点间`VPN`|在两个网络之间通过`IPsec`隧道进行连接的拓扑结构。在每个网络的网关中都设有路由器或防火墙等`VPN`装置，二者之间也建有`IPsec`隧道。|
|中心辐射型`VPN`|星型拓扑结构，将一个中心站点的硬件同多个远程站点的硬件连接而构成的结构。该类型`VPN`一般用于服务供应商提供的`VPN`业务，以服务供应商的基础设施为中心站点，通过`VPN`连接整个组织的其他站点|
|远程接入型`VPN`|用户使用个人计算机上的软件，在家中或者外出时经由互联网与公司的`VPN`装置建立`IPsec`隧道，进而访问公司内部服务器的拓扑结构称为远程接入型`VPN`。远程接入型`IPsec-VPN`子类型需要实现在个人电脑中安装客户端软件，而`SSL-VPN`子类型则是通过`Web`浏览器使用`SSL`连接至公司的`VPN`，通过`SSL`连接与公司内部服务器进行交互|
|`IPsec-VPN`|是使用`IPsec`协议的`VPN`连接，主要用于在站点间`VPN`以及中心辐射型`VPN`中提供经由互联网到站点的安全连接|
|`SSL-VPN`|是一种通过浏览器使用`HTTPS`进行安全`Web`访问的远程接入型`VPN`|



|`DoS`攻击分类|说明|应对|
|-|-|-|
|`Syn Flood`|向攻击对象发送大量的`TCP SYN`分组，从而造成服务器资源过度消耗，一段时间不能提供服务的状态|在防火墙中定义每秒允许通过防火墙的`SYN`分组的数量|
|`ping Flood`|向攻击对象发送大量的`ICMP echo request`分组来消耗服务器内存，使得服务器进入暂时无法提供服务的状态|防火墙定义1s内允许的最大`ICMP`分组数量，对于超过的暂时不予处理|
|`UDP Flood`|向攻击对象发送大量的`UDP`分组来消耗服务器内存，使得服务器进入暂时无法提供服务的状态|防火墙定义1s内能够允许的最大`UDP`分组数量，对于超过的暂时不予处理|
|`IP Flood`|向攻击对象发送大量的`IP`分组来消耗服务器的内存，使得服务器进入暂时无法提供服务的状态|防火墙定义1s内能够允许的最大`IP`分组数量，对于超过的暂时不予处理|
|`Land`|向攻击对象发送大量源地址和目的地址相同的分组。对于一些自身脆弱的硬件，往往会因为向自己转发数据而宕机|防火墙对于该类分组一律丢弃|
|`Tear Drop`|向攻击对象发送经过伪造的，含有重叠偏移量的非法`IP分组`碎片。对于自身脆弱的硬件而言，会发生无法重新生成分组的现象发生，导致宕机|防火墙对于该类分组一律丢弃|
|`Ping of Death`|向攻击对象发送超过`IP`分组最大长度65535的`ping`（`ICMP echo requeset`）消息,对于自身脆弱的硬件而言，会导致其无法运行的情况发生|防火墙对于该类分组一律丢|
|`Smurf`|将攻击对象的地址设置为发送源地址，并广播发送`ICMP echo request`消息，使得攻击对象因收到大量`ICMP echo reply`消息而消耗带宽资源||
|`fraggle`|属于`Smurf`攻击的子类型，使用`UDP`取代`ICMP`发起攻击，并同时利用多种端口。|防火墙一般关闭该类型端口或者使用安全策略进行拦截作为防范对策|
|`Connection Flood`|反复生成大量长时间为`open`状态的连接，从而占据攻击对象的套接字资源。如果服务器端没有最大连接数目的限制，就会发生系统崩溃。也称为`Unix进程控制表`||
|`Reload`|在`Web`浏览器中连续按下`F5`，使得`Web`页面反复执行刷新操作，在`Web`通信较大的时候，会让服务器负载加剧||