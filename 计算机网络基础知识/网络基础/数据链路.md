# 3、数据链路

## 3.1、数据链路的作用

`物理层`将电压高低，光的闪灭与0和1进行转化，而`数据链路层`处理的是0,1序列的集合，叫做帧。

数据链路被视为网络传输中最小的单位。

> 网络拓扑:网络连接和构成的形态，星型、总线型、环型，混合型。



## 3.2、数据链路相关技术

**<font size =4 color = red>`MAC地址`</font>**

> `MAC地址`用于识别`数据链路`中互连的节点。


`MAC地址`有`48bit`，在使用网卡的情况下，`MAC地址`一般都被烧入`ROM`，r任何一个网卡的`MAC地址`都是唯一的。但是也有例外情况，只要相同的`MAC地址`不同时属于一个数据链路就不会出现问题，比如，一台主机要启动多个虚拟机，只能自己给多个虚拟网卡设置MAC地址，很难保证`MAC地址`独一无二。


`MAC地址`一般用十六进制数表示。

|`IEEE802.3规范`|说明|
|-|-|
|第1位|单播地址(0)/多播地址(1)|
|第2位|全局地址(0)/本地地址(1)|
|第3-24位|由`IEEE`管理，不重复，厂商识别码|
|第25-48位|由厂商管理，保证网卡不重复，厂商识别码|


**<font size =4 color = red>`共享介质型网络`与`非共享介质型网络`</font>**

> 依据通信介质的使用方法上看，网络可以分为`共享介质型`和`非共享介质型`

|分类|说明|
|-|-|
|`共享介质型`(半双工通信)|多个设备共用一个通信介质，如之前的`以太网`，`FDDI`，`共享介质型`有两种介质访问方式。 <li>争用方式(`CSMA/CD`)先检查信道上有无数据流动，没有则发，一边发，一边监控信道上有无其他数据流动，有冲突则发一个阻塞报文，放弃发送数据帧，随机延时一段时间之后重新争用介质，进行重发； <li>令牌传递方式，只有获得令牌的站才能够发送数据，特点是不会有冲突，且每个站平等获得令牌。|
|`非共享介质型`(全双工通信)|不共享介质，对介质采取专用的传输控制手段。<li>网络中每个站直连交换机，由交换机负责转发数据帧，比如`ATM`和当下的以太网。交换机可以与计算机之间实现同时收发，实现交换机端口与计算机的一对一连接。<li>缺点就是交换机不能发生故障，否则网络会发生瘫痪，所有计算机都不能进行通信。|


**<font size =4 color = red>根据`MAC地址`转发</font>**

> 以太网交换机（交换集线器）：持有多个端口的网桥，可以根据数据链路层中每个帧的目标`MAC地址`，决定从哪个网络接口发送数据帧。参考的、用以记录的表就是`MAC地址转发表`。

> `MAC地址转发表`：将源`MAC地址`以及曾经接收该`MAC地址`地址发送的包的接口记录到转发表中，无需手动设置，可以自动生成。这个表是不断增大的，是一个自学过程。

`MAC地址转发表`会将某个`MAC地址`作为源地址的包由某一个接口统一接收记录，将某个`MAC地址`作为目标地址的包由某个接口送出记录。

由于`MAC地址`没有层次性，所以随着设备数量增多，`MAC地址转发表`也会越来越大，检索也会越来越久，所以有必要将网络分成多个数据链路。

|交换机转发方式|说明|
|-|-|
|`存储转发`|检查以太网数据帧末尾再转发，可以避免发送错误帧|
|`直通转发`|只需得知目标地址即可开始转发，延迟短，但可能会发送错误帧|

**<font size =4 color = red>环路检测技术</font>**

当使用网桥连接网络时，出现环路时，有可能会出现数据帧在环路中被一致持续转发的情况，当数据帧越积越多时，网络就会发生瘫痪。

> `生成树方式`：每个网桥必须隔一段时间检查网络结构，禁止某些端口的使用，当发生问题时，这些禁止的端口可以作为绕行端口。

> `源路由法`：判断发送数据的源地址是通过哪个网桥实现传输，并将数据帧中写入`RIF`，网桥根据`RIF`将数据帧发送给目标地址，数据帧不会被重复转发。

**<font size =4 color = red>`VLAN`（虚拟局域网）</font>**

同一个交换机可以按照端口区分不同的网段，每个网段通过不同的`VLAN ID`进行区分，在以太网首部加入这个`VLAN ID`就可以决定将数据帧发送给哪个网段。

优点:
- 减少网络负载
- 不需修改布线，只用修改网段即可。


## 3.3、以太网

> 以太网：使用最广泛的数据链路。

普及原因：
- 以太网规范简单，易于网卡及驱动程序实现
- 以太网网卡价格便宜
- 支持高速网络

以太网因通信电缆的不同及通信速度的差异，衍生出很多不同的以太网类型。以太网由`IEEE802.3`进行标准化。


**<font size =4 color = red>以太网帧格式</font>**

![以太网帧图片](https://pic1.zhimg.com/80/v2-d69f6122a8ec686cbf573d96d66b078c_1440w.webp "以太网帧格式")


- `前导码`:8字节，表示一个以太网帧的开始，前导码末尾最后一个字节为`帧开始界定符`，往后就是以太网帧。
- `以太网帧首部`：14个字节，包括6字节的目标`MAC地址`，6字节的源`MAC地址`以及2个字节的上层协议类型。
- `数据`：一个数据帧能容纳的数据范围为46-1500个字节。
- `FCS`：4字节，帧检测序列，检查帧是否损坏。


在`IEEE802.3`以太网帧格式中，与以太网帧格式不同的点在于，原先表示类型的2字节，更换为2字节`帧长度`，而在数据部分的前面有一个`SNAP`字段标识上一层的协议类型，除此之外，数据前面还有个`LLC`字段。

在`VLAN`中，又会在源`MAC地址`和2字节类型字段之间，追加4个字节，其中包含`VLAN ID`。

|数据链路分层|说明|
|-|-|
|介质访问控制层|根据以太网，`FDDI`等不同数据链路特有的首部信息进行控制<li>以太网帧的`前导码`和最后的`FSC`属于以太网帧特有，其他的数据链路帧没有|
|逻辑访问控制|根据以太网，`FDDI`等不同数据链路共有的帧头信息进行控制<li>以太网帧、`FDDI`帧和`ATM`帧中都含有`LLC/SNAP`信息|


## 3.4、无线通信

> 无线通信：使用电磁波，红外线，激光等方式传播数据。


|无线通信|举例|
|-|-|
|短距离无线|`RFID`|
|无线`PAN`|蓝牙(10m左右)|
|无线`LAN`|`Wi-Fi`(100m左右)，无线LAN可以无需拍照使用特定频段，因此无线LAN的无线电波可能会和其他设备相互干扰WiFi|
|无线`MAN`|`WiMAX`（数千米）|
|无线`RAN`||
|无线`WAN`|手机通信`3G`，`4G`，`5G`，`LTE`|

## 3.5、`PPP`(点对点)

> `PPP`：点对点，是1对1连接计算机的协议，相当于OSI参考模型中的数据链路层。

`以太网`和`FDDI`不仅和`数据链路层`有关，还与`物理层`有关；`PPP`是纯粹的数据链路层，与物理层无关，因此仅有`PPP`无法实现通信，还需要有物理层的支持。

|`PPP`连接|介绍|
|-|-|
|`LCP`|不依赖上层的`LCP`协议，负责建立和断开连接，设置最大接收单元`MRU`(Maxumum Receive Unit)，设置验证协议(`PAP`或`CHAP``)以及设置是否进行通信质量的监控|
|`NCP`|依赖上层的`NCP`协议，负责`IP`地址设置以及是否进行`TCP/IP`首部压缩等设置|


建立`PPP`连接，需要用户名和密码验证，并对通信两端进行双向验证。
- `PAP`：通过两次握手进行的用户名和密码验证，用于安全环境不高的环境
- `CHAP`：用一次性密码`OTP`，有效的防止窃听


**<font size =4 color = red>`PPP`数据帧格式</font>**

![](https://img-blog.csdnimg.cn/0ccbee5fccde4616824e347cec11018c.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a-M5aOr5bq36LSo5qOA5ZGY5byg5YWo6JuL,size_20,color_FFFFFF,t_70,g_se,x_16 "PPP数据帧格式")

- `标志码`：第1个字节和最后1个字节，用来区分每个帧，两个标志码中间不允许出现连续6个以上的1，标志码为十六进制的`01111110`
- `地址字节`：1字节，实际不起作用
- `控制字节`：1字节，通常设置为3
- `协议字段`：2字节，标识上一层的协议
- `FSC`：4字节，帧检测序列

在通过电脑拨号的时候，由于`PPP`在软件中实现，`标识码`中的`插0`操作以及`FSC`的计算均由`CPU`去完成，所以`PPP`这种方式会给计算机带来负荷。

**<font size =4 color = red>`PPP`和`以太网`的区别</font>**

- 两者是平级的，都是属于`数据链路层`
- `以太网`可以在同一个广播域中加入多个节点，使用`MAC地址`区分并通信；`PPP`则在同一个广播域中**只能有两个节点**，无法加入第三个节点，所以也并不需要物理地址。
- 与`以太网`不同，`PPP`只有在建立链路之后才可以通信。

**<font size =4 color = red>`PPPoE`(`PPP over Ethernet`)</font>**

> `PPPoE`：以太网上的点对点协议，将`PPP`封装在`以太网`框架上个一种数据链路层协议。


先封装`PPP`数据帧，再将这个数据帧封装进`以太网`数据帧(`以太网首部`和`数据`之间)。


单纯的`以太网`没有验证功能，同时也没有建立和断开连接的处理，因此无法按时计费。`PPPoE`旨在解决：用户认证、用户设备能够通过与运营商的自动协商来自动配置`IP`地址等问题。


## 3.6、其他数据链路


> ATM：以信元单位（5字节首部+48字节数据）进行传输的数据链路。


**<font size =4 color = red>`ATM`的特点</font>**

- `ATM`是一种面向连接的数据链路，通信前需要设置通信线路；
- 建立连接时，先向交换机发出一个信令要求，建立交换机和通话对端的链接；
- `ATM`允许同时多个对端建立连接；
- `ATM`没有发送权限的限制，可能会出现拥堵，增加了限制带宽。


`ATM`一个信元只能发送固定48字节数据，若包含`IP`首部和`TCP`首部，则基本无法存放上层数据。一般不会单独使用`ATM`，而是使用上层的`AAL`，每个`IP`包被附加各层协议首部之后，最多被分为192个信元发送出去。但是只要丢失一个，就需要重发所有，这是`ATM`的最大弊端。

**<font size =4 color = red>`FDDI`(分布式光纤数据接口)</font>**

`FDDI`中的每个站通过光纤连接成环状，采用双环结构。采用`令牌环`的访问方式，在网络拥堵的情况下，容易出现网络拥堵。

**<font size =4 color = red>`HDMI`(高清晰度多媒体接口)</font>**

通过一根缆线实现图像和声音等数字信号的高品质传输。

`HDMI`可以用来传输以太网帧。



## 3.7、公共通信服务

> 公共通信服务类似于网络运营商提供的电话网络。


|公共通信服务举例|说明|
|-|-|
|模拟电话线路|利用固定电话线路进行通信，电话线中的音频带宽用于拨号上网，该方法不需要特殊的通信线路。<li>`猫`将数字信号转化成为模拟信号，通过电话线使用`PPP`接入`ISP`的网络，访问服务器，连接互联网，如今`猫`速度慢，逐渐淘汰|
|移动通信服务|只要在服务范围内，即可连接运营商的网络|
|`ASDL`|对已经有的模拟电话线路进行扩展的服务|
|`FTTH`|一根高速光缆直接连到用户或者公司建筑，通过`ONU`将计算机与之关联。|
|有线电视||
|专线||
|`VPN`(虚拟专用网络)|通过互联网在设备之间建立私有的网络连接。`VPN`用于通过公有网络安全且匿名地传输数据。它们的原理是通过掩蔽用户`IP`地址并加密数据，使未获得接收信息授权的人无法读取。|
|公共无线`LAN`|公共场所的热点，在人员比较集中的地方假设一个叫做`热点`的无线电波器|
